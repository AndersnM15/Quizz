<!DOCTYPE html>
<html>
<head>
  <title>100 Programadores Dijeron</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="KRAKE NEGRO.png">
</head>
<body>
  <div class="container">
  <h2><span>🎯</span> 100 Programadores Dijeron <span>🎯</span></h2>
  <div id="question">Selecciona una pregunta para comenzar</div>

  <div class="scoreboard" style="margin-top:12px;">
    <div class="card">
      <div>Grupo Onichan</div>
      <div class="value" id="scoreA">0</div>
    </div>
    <div class="card">
      <div>Total Ronda</div>
      <div class="value" id="roundPot">0</div>
    </div>
    <div class="card">
      <div>Equipo Dinamita</div>
      <div class="value" id="scoreB">0</div>
    </div>
  </div>

  <div id="roundInfo" style="margin-top:8px;">
    <span>Strikes: <strong id="strikeCount">0</strong></span>
    <div id="strikeDisplay" class="strike-display"></div>
  </div>
  <div id="answers">
    <div data-num="1" class="covered">
      <span class="text">Respuesta 1</span> 
      <span class="points">0</span>
      <span class="answer-emoji" style="display: none;">🎉</span>
    </div>
    <div data-num="2" class="covered">
      <span class="text">Respuesta 2</span> 
      <span class="points">0</span>
      <span class="answer-emoji" style="display: none;">🎉</span>
    </div>
    <div data-num="3" class="covered">
      <span class="text">Respuesta 3</span> 
      <span class="points">0</span>
      <span class="answer-emoji" style="display: none;">🎉</span>
    </div>
    <div data-num="4" class="covered">
      <span class="text">Respuesta 4</span> 
      <span class="points">0</span>
      <span class="answer-emoji" style="display: none;">🎉</span>
    </div>
  </div>
  </div>
  <script src="main.js"></script>
  <script>
    let current = null;
    let strikeCount = 0;
    let roundPot = 0;
    let scores = { A: 0, B: 0 };

    // Función para actualizar la visualización de strikes
    function updateStrikeDisplay() {
      const strikeDisplay = document.getElementById('strikeDisplay');
      strikeDisplay.innerHTML = '';
      
      for (let i = 0; i < strikeCount; i++) {
        const strikeKrake = document.createElement('img');
        strikeKrake.className = 'strike-krake';
        strikeKrake.src = './Krakesito-Triste.ico';
        strikeKrake.alt = 'Strike';
        strikeDisplay.appendChild(strikeKrake);
      }
    }



    function resetBoard() {
      const nodes = document.querySelectorAll('#answers > div');
      nodes.forEach((node) => {
        node.classList.remove('reveal', 'zero-points');
        node.classList.add('covered');
        node.style.visibility = 'visible';
        node.querySelector('.text').textContent = '———';
        node.querySelector('.points').textContent = '—';
        // Ocultar emoji
        const emoji = node.querySelector('.answer-emoji');
        if (emoji) {
          emoji.style.display = 'none';
          emoji.classList.remove('show');
        }
      });
    }

         function closeWinnerModal() {
       const overlays = document.querySelectorAll('.winner-overlay');
       overlays.forEach(overlay => overlay.remove());
     }

      function createConfetti(answerElement) {
        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd', '#ff9f43', '#10ac84'];
        const confettiCount = 20;
        
        // Crear el logo central
        const logo = document.createElement('img');
logo.src = './Krakesito-Feliz.ico';
logo.className = 'celebration-logo';
logo.style.cssText = `
  position: absolute;
  width: 120px; 
  height: 120px;
  pointer-events: none;
  z-index: 1001;
  animation: logoCelebration 2.5s ease-out forwards;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
`;

        
        // Posición inicial desde el elemento de respuesta
        const rect = answerElement.getBoundingClientRect();
        const startX = rect.left + rect.width / 2;
        const startY = rect.top + rect.height / 2;
        
        // Centrar mejor el logo
        logo.style.left = (startX - 60) + 'px';
        logo.style.top = (startY - 60) + 'px';
        
        document.body.appendChild(logo);
        
        // Crear serpentinas alrededor del logo
        for (let i = 0; i < confettiCount; i++) {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          
          // Formas variadas de serpentinas
          const shapes = ['circle', 'square', 'triangle'];
          const shape = shapes[Math.floor(Math.random() * shapes.length)];
          const size = 6 + Math.random() * 8;
          
          let shapeStyle = '';
          if (shape === 'circle') {
            shapeStyle = `border-radius: 50%;`;
          } else if (shape === 'square') {
            shapeStyle = `border-radius: 2px;`;
          } else if (shape === 'triangle') {
            shapeStyle = `clip-path: polygon(50% 0%, 0% 100%, 100% 100%);`;
          }
          
          confetti.style.cssText = `
            position: absolute;
            width: ${size}px;
            height: ${size}px;
            background: ${colors[Math.floor(Math.random() * colors.length)]};
            ${shapeStyle}
            pointer-events: none;
            z-index: 1000;
            animation: confettiFall 2.5s ease-out forwards;
            animation-delay: ${Math.random() * 0.3}s;
          `;
          
          confetti.style.left = startX + 'px';
          confetti.style.top = startY + 'px';
          
          // Velocidad y dirección aleatoria más dinámica
          const angle = (Math.PI * 2 * i) / confettiCount + (Math.random() - 0.5) * 0.5;
          const velocity = 80 + Math.random() * 120;
          const vx = Math.cos(angle) * velocity;
          const vy = Math.sin(angle) * velocity - 30;
          
          confetti.style.setProperty('--vx', vx + 'px');
          confetti.style.setProperty('--vy', vy + 'px');
          
          document.body.appendChild(confetti);
          
          // Remover después de la animación
          setTimeout(() => {
            if (confetti.parentNode) {
              confetti.parentNode.removeChild(confetti);
            }
          }, 2500);
        }
        
        // Remover el logo después de la animación
        setTimeout(() => {
          if (logo.parentNode) {
            logo.parentNode.removeChild(logo);
          }
        }, 2500);
      }



    onSocketJSON((data) => {
      if (data.type === "select_question") {
        current = data.payload;
        document.getElementById("question").textContent = current.question;
        // Mostrar 5 respuestas cubiertas con sus textos ya cargados
        const nodes = document.querySelectorAll('#answers > div');
        nodes.forEach((node, index) => {
          const ans = current.answers[index];
          node.style.visibility = 'visible';
          node.classList.remove('reveal', 'zero-points');
          node.classList.add('covered');
          if (ans) {
            node.querySelector('.text').textContent = ans.text;
            node.querySelector('.points').textContent = String(ans.points);
          } else {
            node.querySelector('.text').textContent = '———';
            node.querySelector('.points').textContent = '—';
          }
          // Ocultar emoji
          const emoji = node.querySelector('.answer-emoji');
          if (emoji) {
            emoji.style.display = 'none';
            emoji.classList.remove('show');
          }
        });
        // reset estado de ronda
        strikeCount = 0; roundPot = 0;
        document.getElementById('strikeCount').textContent = '0';
        document.getElementById('roundPot').textContent = '0';
        updateStrikeDisplay();
        // Comunicar reset de ronda
        sendEvent({ type: 'reset_round' });
      }
      if (data.type === "reveal_answer" && current) {
        const n = data.number;
        const ans = current.answers[n - 1];
        if (!ans) return;
        const node = document.querySelector(`#answers > div[data-num="${n}"]`);
        if (!node) return;
        
        // Revelar la respuesta
        node.classList.remove('covered');
        void node.offsetWidth; // fuerza reflow
        
        // Aplicar clase especial para respuestas con puntaje mínimo
        const minPoints = Math.min(...current.answers.filter(a => a).map(a => a.points));
        if (ans.points === minPoints) {
          node.classList.add('reveal', 'zero-points');
        } else {
          node.classList.add('reveal');
        }
        
                 // Mostrar emoji después de un pequeño delay
         setTimeout(() => {
           const emoji = node.querySelector('.answer-emoji');
           if (emoji) {
             // Cambiar emoji según si es correcto o incorrecto
             const minPoints = Math.min(...current.answers.filter(a => a).map(a => a.points));
             if (ans.points > minPoints) {
               emoji.textContent = '🎉';
               // Crear serpentinas para respuestas correctas
               createConfetti(node);
             } else {
               emoji.textContent = '🎉';
               // Crear confeti para respuestas incorrectas también
               createConfetti(node);
             }
             emoji.style.display = 'block';
             // Pequeño delay para la animación del emoji
             setTimeout(() => {
               emoji.classList.add('show');
             }, 100);
           }
         }, 300);
        
        // emitir evento (la suma se hará al recibir round_points_add)
        sendEvent({ type: 'round_points_add', value: ans.points });
      }
      if (data.type === 'strike') {
        strikeCount = Math.min(3, strikeCount + 1);
        document.getElementById('strikeCount').textContent = String(strikeCount);
        updateStrikeDisplay();
      }
      if (data.type === 'undo_strike') {
        strikeCount = 0;
        document.getElementById('strikeCount').textContent = '0';
        updateStrikeDisplay();
      }
      if (data.type === 'round_points_add') {
        roundPot += data.value;
        document.getElementById('roundPot').textContent = String(roundPot);
      }
      if (data.type === 'reset_round') {
        roundPot = 0;
        document.getElementById('roundPot').textContent = '0';
      }
      if (data.type === 'assign_round') {
        scores[data.group] += roundPot;
        roundPot = 0;
        document.getElementById('roundPot').textContent = '0';
        document.getElementById('scoreA').textContent = String(scores.A);
        document.getElementById('scoreB').textContent = String(scores.B);
      }
      if (data.type === 'show_winner') {
        // Limpiar overlays existentes antes de crear uno nuevo
        closeWinnerModal();
        
        const winner = scores.A > scores.B ? 'Onichan' : scores.B > scores.A ? 'Equipo Dinamita' : 'Empate';
        let message = '';
        if (winner === 'Empate') {
          message = '¡Empate! Ambos equipos tienen la misma puntuación.';
        } else {
          message = `¡Ganador: ${winner}!`;
        }
        
        // Crear overlay para mostrar el ganador
        const overlay = document.createElement('div');
        overlay.className = 'winner-overlay';
        overlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
        `;
        
        const winnerBox = document.createElement('div');
        winnerBox.style.cssText = `
          background: white;
          padding: 40px;
          border-radius: 20px;
          text-align: center;
          max-width: 500px;
          box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        `;
        
        winnerBox.innerHTML = `
          <h1 style="color: #2563eb; margin-bottom: 20px;">🏆 ¡Fin del Juego! 🏆</h1>
          <h2 style="margin-bottom: 20px;">${message}</h2>
          <div style="font-size: 18px; margin-bottom: 30px;">
            <div>Grupo Onichan: ${scores.A} puntos</div>
            <div>Dinamita: ${scores.B} puntos</div>
          </div>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <button onclick="closeWinnerModal()" style="
              background: #6b7280;
              color: white;
              border: none;
              padding: 12px 24px;
              border-radius: 8px;
              font-size: 16px;
              cursor: pointer;
            ">Cerrar</button>
            <button onclick="resetGame(); closeWinnerModal()" style="
              background: #10b981;
              color: white;
              border: none;
              padding: 12px 24px;
              border-radius: 8px;
              font-size: 16px;
              cursor: pointer;
            ">Nuevo Juego</button>
          </div>
        `;
        
        overlay.appendChild(winnerBox);
        document.body.appendChild(overlay);
      }
      if (data.type === 'reset_game') {
        // reset estado de ronda
        strikeCount = 0; roundPot = 0;
        document.getElementById('strikeCount').textContent = '0';
        document.getElementById('roundPot').textContent = '0';
        updateStrikeDisplay();
        // reset puntuaciones
        scores = { A: 0, B: 0 };
        document.getElementById('scoreA').textContent = '0';
        document.getElementById('scoreB').textContent = '0';
        // reset preguntas
        current = null;
        document.getElementById('question').textContent = '';
        // reset respuestas
        resetBoard();
      }
    });
    
    // Inicializar la visualización de strikes al cargar la página
    updateStrikeDisplay();
  </script>
</body>
</html>
